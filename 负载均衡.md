# 负载均衡（Load Balancer）

## 负载均衡策略

轮询、随机、最小响应时间、最小并发数等等

## 负载均衡方案

### 集中式负载均衡

第一种是集中式 LB 方案，在服务消费者和服务提供者之间有一个独立的 LB，LB 通常是专门的硬件设备如 F5，或者基于软件如 LVS，HAproxy 等实现。

![img](http://img.mp.itc.cn/upload/20170820/e16eb70a1a6f491ba39938ab3da7079d.jpg)

服务调用者调用服务时，向 LB 发起请求，LB 再根据一定的策略（比如轮询、随机、最小响应时间、最小并发数等等）将请求路由到指定的服务。这个方案的最大问题是：调用者和提供者之间增加了一跳，LB 也最有可能成为整个系统的瓶颈。

### 进程内负载均衡（软负载、客户端负载）

针对集中式 LB 的不足，进程内 LB 方案将 LB 的功能以库的形式集成到服务消费方进程里头，该方案也被称为软负载 (Soft Load Balancing) 或者客户端负载方案。

![img](http://img.mp.itc.cn/upload/20170820/6e09be92e8ac49c9883125d07623b41c_th.jpg)

其**原理**是：服务提供者将自身的地址发送到服务注册中心，同时定时发送心跳给注册中心，注册中心按心跳情况判断是否将此节点从注册表中摘除。服务调用者调用服务时，先从注册中心拉取服务注册信息，然后根据一定的策略去调用服务节点。

这种情况下，即使注册中心宕机，调用方也可以根据内存中已经拉到的服务地址将请求路由到正确的服务上去。这个方案的最大问题是：服务调用者可能需要集成注册中心的客户端，即将来注册中心服务端升级，可能会需要升级注册中心客户端。

### 主机独立负载均衡进程

![img](http://img.mp.itc.cn/upload/20170820/4cb4fa26de97478b82fcc78d3fd7cdaa_th.jpg)

第三种是主机独立 LB 进程方案，该方案是针对第二种方案的不足而提出的一种折中方案，原理和第二种方案基本类似，不同之处是，他将 LB 和服务发现功能从进程内移出来，变成主机上的一个独立进程，主机上的一个或者多个服务要访问目标服务时，他们都通过同一主机上的独立 LB 进程做服务发现和负载均衡。该方案的典型案例是 Airbnb 的 SmartStack 服务发现框架。这个方案的最大问题是：部署和运维比较麻烦。

以上三点摘自杨波先生的《实施微服务，我们需要哪些基础框架？》

http://www.infoq.com/cn/articles/basis-frameworkto-implement-micro-service#anch130564 

